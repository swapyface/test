
# Improved Code
import pandas as pd

def generate_master_table(self, num_days, end_date):
    """
    Generate a master table by fetching snapshots in batches and combining them into a single DataFrame.
    """
    # Generate date series for the snapshot IDs
    snapshot_ids = []
    for batch_date in self.generate_date_series(num_days, formatted_end_date=end_date):
        snapshot_id = self.get_snapshot_id(batch_date, self.snapshot)
        snapshot_ids.append(snapshot_id)

    # Split snapshot IDs into manageable chunks
    snapshot_id_chunks = self.split_snapshot_ids(snapshot_ids)

    # Initialize the master table
    master_table = None

    # Fetch data in chunks and concatenate into the master table
    for chunk in snapshot_id_chunks:
        table = self.fetch_data(chunk)
        if master_table is None:
            master_table = table
        else:
            master_table = pd.concat([master_table, table], ignore_index=True)

    # Convert the master table to a DataFrame with appropriate column names
    data = pd.DataFrame(master_table, columns=self.master_table_column_names)

    return data
