import pandas as pd
import numpy as np
from sklearn.cluster import DBSCAN
import matplotlib.pyplot as plt
import seaborn as sns

# Example dataset with just numerical variable 'price'
data = pd.DataFrame({
    'price': [100, 105, 110, 500, 510, 505, 1000, 1005, 1010]
})

# Apply DBSCAN
dbscan = DBSCAN(eps=10, min_samples=2)
data['label'] = dbscan.fit_predict(data[['price']])

# Convert labels: 1 for non-outliers, 0 for outliers (-1 in DBSCAN)
data['outlier'] = np.where(data['label'] == -1, 0, 1)

# Save result to CSV
data.to_csv('dbscan_outliers.csv', index=False)

# Create a box plot
plt.figure(figsize=(10, 6))
sns.boxplot(y=data['price'], showfliers=False)

# Plot outliers in red and non-outliers in blue
outliers = data[data['outlier'] == 0]
non_outliers = data[data['outlier'] == 1]

# Plot individual points
plt.scatter(np.full(non_outliers.shape[0], 0), non_outliers['price'], color='blue', label='Non-Outlier', edgecolor='black')
plt.scatter(np.full(outliers.shape[0], 0), outliers['price'], color='red', label='Outlier', edgecolor='black')

# Customize plot
plt.legend(loc='upper right')
plt.title('DBSCAN Outlier Detection')
plt.ylabel('Price')
plt.show()
